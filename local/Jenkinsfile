{ -> docker.image('slave-sbt').inside 
    {
        stage('Build') {
            sh sbt('compile')
        }
        stage('Test') {
            sh sbt('test')
        }
        stage('Deploy Locally') {
            sh sbt('docker:publishLocal')
        }
        stage('Push to GitHub') {
            withCredentials([[$class: 'UsernamePasswordMultiBinding', 
                              credentialsId: 'github',
                              usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD']]) {
                sh "git push -f https://$USERNAME:$PASSWORD@github.com/NET-A-PORTER/jenkinsworld-2017-sample-app HEAD:${env.BRANCH_NAME}"
            }
        }
    }
}

def sbt(target) {
    return "sbt -no-colors $target"
}
